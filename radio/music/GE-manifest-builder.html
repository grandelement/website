<!doctype html>
<meta charset="utf-8">
<title>GE Radio — Manifest Builder</title>
<style>
  html,body{font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;padding:0;background:#0b0e17;color:#e7e7e7}
  .wrap{max-width:900px;margin:40px auto;padding:24px;background:#121522;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  h1{margin:0 0 12px;font-size:22px}
  label{display:block;margin:14px 0 6px;font-weight:600}
  input[type=text]{width:100%;padding:.6rem .75rem;border-radius:10px;border:1px solid #263045;background:#0e1220;color:#e7e7e7}
  .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
  button{padding:.6rem .9rem;border-radius:10px;border:1px solid #3a445e;background:#1a2237;color:#fff;font-weight:700;cursor:pointer}
  button:disabled{opacity:.6;cursor:not-allowed}
  pre{background:#0e1220;border:1px solid #263045;border-radius:10px;padding:12px;overflow:auto;max-height:360px;margin-top:12px}
  .small{font-size:12px;opacity:.8}
</style>
<div class="wrap">
  <h1>GE Radio — Build <code>music/manifest.json</code></h1>
  <label>GitHub repo (owner/repo[/branch])</label>
  <input id="repo" type="text" placeholder="grandelement/radio/main" value="grandelement/radio/main">
  <div class="row">
    <button id="scan">Scan repo</button>
    <button id="dl" disabled>Download manifest.json</button>
  </div>
  <div class="small">We fetch one tree listing from GitHub’s API and filter audio under <code>music/</code> or <code>clips/</code>. No tokens needed.</div>
  <pre id="log">Ready.</pre>
</div>
<script>
(function(){
  const log = (m)=>{ const el=document.getElementById('log'); el.textContent += (el.textContent ? "\n" : "") + m; };
  const AUDIO=/\.(mp3|m4a|aac|ogg|oga|wav|aif|aiff|flac)$/i;
  async function scan(){
    const s=document.getElementById('repo').value.trim()||'grandelement/radio/main';
    const parts=s.split('/'); const owner=parts[0], repo=parts[1], branch=parts[2]||'main';
    const url=`https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;
    log(`Fetching tree: ${url}`);
    const r=await fetch(url,{headers:{'Accept':'application/vnd.github+json'}});
    if(!r.ok){ log('Error: '+r.status+' '+r.statusText); return []; }
    const j=await r.json(); const tree=Array.isArray(j.tree)?j.tree:[];
    const all=tree.filter(t=>t.type==='blob' && AUDIO.test(t.path));
    const pick=all.filter(x=>x.path.startsWith('music/') || x.path.startsWith('clips/')).map(x=>x.path);
    log(`Found ${pick.length} audio files under music/ or clips/`);
    const txt = JSON.stringify(pick, null, 2);
    document.getElementById('log').textContent = txt;
    const dl=document.getElementById('dl'); dl.disabled=false;
    dl.onclick=()=>{
      const blob=new Blob([txt],{type:'application/json'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download='manifest.json';
      a.click();
      URL.revokeObjectURL(a.href);
    };
  }
  document.getElementById('scan').addEventListener('click', scan);
})();</script>
