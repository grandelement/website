<!doctype html>
<meta charset="utf-8">
<title>GE Music Manifest Builder</title>
<style>
  html,body{font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;padding:0;background:#0b0e17;color:#e7e7e7}
  .wrap{max-width:980px;margin:40px auto;padding:24px;background:#121522;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  h1{margin:0 0 10px;font-size:22px}
  .small{font-size:12px;opacity:.82}
  .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px;align-items:center}
  button{padding:.6rem .9rem;border-radius:10px;border:1px solid #3a445e;background:#1a2237;color:#fff;font-weight:800;cursor:pointer}
  button:disabled{opacity:.6;cursor:not-allowed}
  pre{background:#0e1220;border:1px solid #263045;border-radius:10px;padding:12px;overflow:auto;max-height:420px;margin-top:12px}
  code{background:#0e1220;border:1px solid #263045;border-radius:6px;padding:0 .35rem}
</style>

<div class="wrap">
  <h1>GE Music Manifest Builder</h1>
  <div class="small">
    Picks your local <code>ge-music</code> folder and generates a <code>manifest.json</code> list of:
    <code>music/...</code> and <code>clips/...</code> files.
    <br><br>
    Output is ready to drop into: <code>website/radio/music/manifest.json</code>
  </div>

  <div class="row">
    <input id="pick" type="file" webkitdirectory multiple style="padding:.6rem .9rem;border-radius:10px;border:1px solid #263045;background:#0e1220;color:#e7e7e7">
    <label class="small" style="margin:0;display:flex;gap:8px;align-items:center">
      <input id="includeClips" type="checkbox" checked> Include clips/
    </label>
    <label class="small" style="margin:0;display:flex;gap:8px;align-items:center">
      <input id="sortAlpha" type="checkbox" checked> Sort Aâ€“Z
    </label>
    <button id="dl" disabled>Download manifest.json</button>
  </div>

  <pre id="log">Pick your local <code>ge-music</code> repo folder above.</pre>
</div>

<script>
(() => {
  const AUDIO = /\.(mp3|m4a|aac|ogg|oga|wav|aif|aiff|flac)$/i;
  const logEl = document.getElementById('log');
  const dl = document.getElementById('dl');
  const pick = document.getElementById('pick');

  function log(s){ logEl.textContent = String(s); }

  pick.addEventListener('change', () => {
    const includeClips = document.getElementById('includeClips').checked;
    const sortAlpha = document.getElementById('sortAlpha').checked;

    const files = Array.from(pick.files || []);
    const out = [];

    for(const f of files){
      const rel = (f.webkitRelativePath || f.name).replace(/\\/g,'/');
      if(!AUDIO.test(rel)) continue;

      // Expect paths like: ge-music/music/... or ge-music/clips/...
      const idxMusic = rel.indexOf('/music/');
      const idxClips = rel.indexOf('/clips/');

      if (idxMusic >= 0){
        out.push(rel.slice(idxMusic + 1)); // keep "music/..."
      } else if (includeClips && idxClips >= 0){
        out.push(rel.slice(idxClips + 1)); // keep "clips/..."
      }
    }

    if(sortAlpha) out.sort((a,b)=>a.localeCompare(b));

    const txt = JSON.stringify(out, null, 2);
    log(`Found ${out.length} audio files\n\n` + txt);

    dl.disabled = false;
    dl.onclick = () => {
      const blob = new Blob([txt], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'manifest.json';
      a.click();
      setTimeout(()=>URL.revokeObjectURL(a.href), 1500);
    };
  });
})();
</script>
