<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>GE Image Manifest Creator</title>
<style>
  html,body{margin:0;padding:0;background:#0b1117;color:#e8f6ff;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:900px;margin:0 auto;padding:24px}
  h1{margin:0 0 8px 0}
  .card{background:#121a22;border:1px solid #2a3a4a;border-radius:14px;padding:16px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  button{appearance:none;border:1px solid #2a3a4a;background:#0e1a24;color:#e8f6ff;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
  #list{margin-top:10px;max-height:50vh;overflow:auto;background:#0e151c;border:1px solid #263646;border-radius:10px;padding:10px}
  code{background:#0e151c;border:1px solid #263646;border-radius:8px;padding:6px 8px;display:block;white-space:pre-wrap}
  .muted{opacity:.85}
</style>
</head>
<body>
<div class="wrap">
  <h1>GE Image Manifest Creator</h1>
  <p class="muted">Drop image files here, or click “Pick files”. The tool will sort them numerically then alphabetically and export <b>img/manifest.json</b>.</p>
  <div class="card">
    <div class="row">
      <input id="picker" type="file" accept="image/*" multiple style="display:none" />
      <button id="pickBtn">Pick files</button>
      <button id="saveBtn" disabled>Save manifest.json</button>
    </div>
    <div id="list"></div>
    <h3>Preview</h3>
    <code id="preview">[]</code>
  </div>
</div>
<script>
  const pickBtn = document.getElementById('pickBtn');
  const saveBtn = document.getElementById('saveBtn');
  const picker  = document.getElementById('picker');
  const listEl  = document.getElementById('list');
  const preview = document.getElementById('preview');
  let files = [];

  function sortNames(arr){
    const num = s => { const m = s.match(/^(\d+)/); return m ? parseInt(m[1],10) : Number.MAX_SAFE_INTEGER; };
    return arr.slice().sort((a,b)=> num(a)-num(b) || a.localeCompare(b));
  }

  function toJSON(){
    const names = sortNames(files.map(f=>f.name));
    return names;
  }

  function render(){
    const names = toJSON();
    listEl.innerHTML = names.map(n=>`<div>${n}</div>`).join('');
    preview.textContent = JSON.stringify(names, null, 2);
    saveBtn.disabled = !names.length;
  }

  pickBtn.addEventListener('click', ()=> picker.click());
  picker.addEventListener('change', ()=>{
    files = Array.from(picker.files||[]).filter(f=>/^image\//.test(f.type));
    render();
  });

  document.addEventListener('dragover', e=>{ e.preventDefault(); }, {passive:false});
  document.addEventListener('drop', e=>{
    e.preventDefault();
    const items = Array.from(e.dataTransfer.files||[]);
    files = items.filter(f=>/^image\//.test(f.type));
    render();
  }, {passive:false});

  async function saveJSON(){
    const data = new Blob([JSON.stringify(toJSON(), null, 2)], {type:'application/json'});
    if (window.showSaveFilePicker){
      const handle = await window.showSaveFilePicker({
        suggestedName:'manifest.json',
        types:[{description:'JSON', accept:{'application/json':['.json']}}]
      });
      const writable = await handle.createWritable();
      await writable.write(data);
      await writable.close();
      alert('Saved manifest.json');
    } else {
      const a = document.createElement('a');
      a.href = URL.createObjectURL(data);
      a.download = 'manifest.json';
      document.body.appendChild(a); a.click(); a.remove();
    }
  }
  saveBtn.addEventListener('click', saveJSON);
</script>
</body>
</html>
